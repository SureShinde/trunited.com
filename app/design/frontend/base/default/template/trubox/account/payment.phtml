<?php
/**
 * Magestore
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magestore.com license that is
 * available through the world-wide-web at this URL:
 * http://www.magestore.com/license-agreement.html
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Magestore
 * @package     Magestore_RewardPoints
 * @copyright   Copyright (c) 2012 Magestore (http://www.magestore.com/)
 * @license     http://www.magestore.com/license-agreement.html
 */

/**
 * Rewardpoints Account Dashboard
 *
 * @see Magestore_RewardPoints_Block_Account_Dashboard
 */
$truBox = Mage::helper('trubox')->getCurrentTruBox();
$is_applied_tgc = false;
if ($truBox != null)
    $is_applied_tgc = $truBox->getData('use_trugiftcard') == 1 ? true : false;

$cards = $this->getPaymentTruBox();
?>
<div class="right_block_in">
    <?php echo $this->getChildHtml('global_messages'); ?>
    <div class="search_bar last padd_bot text-center">
        <h3 class="text-uppercase"><?php echo $this->__('My TruBox Payment')?></h3>
        <div class="clearfix"></div>
    </div>
    <div class="food_beverages_main ">
        <div class="trubox_payment trubox_index">
            <form class="items" id="trubox-payment-information"
                  action="<?php echo $this->savePaymentUrl() ?>"
                  method="POST">
                <ul class="form-list" id="payment_form_ccsave">
                    <?php if (sizeof($cards) > 0) { ?>
                        <li>
                            <label for="current_credit_card"><?php echo $this->__('Credit Card') ?></label>
                            <select id="current_credit_card" name="current_credit_card" class="required-entry">
                                <option value=""><?php echo $this->__('Select');?></option>
                                <?php foreach ($cards as $card) { ?>
                                    <option <?php if($card->getData('use_in_trubox')){?>selected="selected"<?php }?>
                                            value="<?php echo $card->getId(); ?>"><?php echo $card->getLabel(); ?></option>
                                <?php } ?>
                            </select>
                            <a href="<?php echo $this->getCardUrl(); ?>"
                               title="<?php echo $this->__('Create, update or use a different card') ?>">
                                <?php echo $this->__('Create, update or use a different card') ?>
                            </a>
                        </li>
                    <?php } else { ?>
                        <input type="hidden" id="current_credit_card" name="current_credit_card" value=""/>
                        <a href="<?php echo $this->getCardUrl(); ?>"
                           title="<?php echo $this->__('Create, update or use a different card') ?>">
                            <?php echo $this->__('Create, update or use a different card') ?>
                        </a>
                    <?php } ?>

                    <li>
                        <div class="input-box apply_trugiftcard">


                            <label for="use_trugiftcard">
                                <input type="checkbox" id="use_trugiftcard" name="use_trugiftcard"
                                       title="<?php echo $this->__('Use Trunited Gift Card') ?>"
                                       <?php if ($is_applied_tgc){ ?>checked="checked"<?php } ?>
                                       style="-webkit-appearance: checkbox !important; "
                                />
                                <span><?php echo $this->__('Apply Trunited Gift Card balance when available') ?></span>
                            </label>

                            <img
                                    src="<?php echo $this->getSkinUrl('images/onestepcheckout/flatnew/trugiftcard.png'); ?>"
                                    title="<?php echo $this->__('Trunited Gift Card balance'); ?>"/>
                        </div>
                    </li>
                </ul>
                <div class="buttons-set">
                    <button class="btn transition btn-trubox" type="submit">
                        <?php echo $this->__('Save Payment') ?>
                    </button>
                </div>
            </form>
        </div>
    </div>
    <?php echo $this->getChildHtml('other') ?>
</div>
<div class="clearfix"></div>

<script type="text/javascript">
    var trubox_payment_information = new VarienForm('trubox-payment-information', true);

    $j = jQuery.noConflict();
    $j('.page-title').focus();

    $j(".sidebar.active .sub_blk").show();
    $j(".sidebar.active .sub_blk").slideDown();

    $j('.main-container').addClass('main_block inn_pad main_bg2');
    $j('.direct_comsumer').html('<h1 class="inner_pad">The Trubox Club</h1>');

    $$('.cvv-what-is-this').each(function (element) {
        Event.observe(element, 'click', toggleToolTip);
    });
</script>

