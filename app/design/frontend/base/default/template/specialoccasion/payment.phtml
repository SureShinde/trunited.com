<?php
/**
 * Magestore
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magestore.com license that is
 * available through the world-wide-web at this URL:
 * http://www.magestore.com/license-agreement.html
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Magestore
 * @package     Magestore_RewardPoints
 * @copyright   Copyright (c) 2012 Magestore (http://www.magestore.com/)
 * @license     http://www.magestore.com/license-agreement.html
 */

/**
 * Rewardpoints Account Dashboard
 *
 * @see Magestore_RewardPoints_Block_Account_Dashboard
 */

$occasion = Mage::helper('specialoccasion')->getCurrentOccasion();
$is_applied_tgc = false;
if ($occasion != null)
    $is_applied_tgc = $occasion->getData('use_trugiftcard') == 1 ? true : false;

$cards = $this->getPaymentOccasion();
?>

<div class="right_block_in">
    <div class="search_bar last padd_bot text-center">
        <h3 class="pad_last"><?php echo $this->__('SPECIAL OCCASION PAYMENT');?></h3>
        <div class="clearfix"></div>
    </div>
    <div class="never_forgot">
        <h4><?php echo $this->__('Never Forget');?><br><?php echo $this->__('To Send Flowers, Again!');?></h4>
        <div class="never_forgot_under">
            <form id="occasion-payment-information" action="<?php echo $this->savePaymentUrl() ?>" method="post">
                <h5><?php echo $this->__('The Payment');?></h5>
                <div class="trubox_index trubox_payment">
                    <ul>
                        <?php if (sizeof($cards) > 0) { ?>
                            <li class="col-md-12">
                                <label for="current_credit_card"><?php echo $this->__('Credit Card') ?></label>
                                <select id="current_credit_card" name="current_credit_card" class="required-entry">
                                    <option value=""><?php echo $this->__('Select');?></option>
                                    <?php foreach ($cards as $card) { ?>
                                        <option <?php if($card->getData('use_in_occasion')){?>selected="selected"<?php }?>
                                                value="<?php echo $card->getId(); ?>"><?php echo $card->getLabel(); ?></option>
                                    <?php } ?>
                                </select>
                                <a href="<?php echo $this->getCardUrl(); ?>"
                                   title="<?php echo $this->__('Create, update or use a different card') ?>">
                                    <?php echo $this->__('Create, update or use a different card') ?>
                                </a>
                            </li>
                        <?php } else { ?>
                            <input type="hidden" id="current_credit_card" name="current_credit_card" value=""/>
                            <a href="<?php echo $this->getCardUrl(); ?>"
                               title="<?php echo $this->__('Create, update or use a different card') ?>">
                                <?php echo $this->__('Create, update or use a different card') ?>
                            </a>
                        <?php } ?>

                        <li class="col-md-12">
                            <div class="input-box apply_trugiftcard">
                                <label for="use_trugiftcard">
                                    <input type="checkbox" id="use_trugiftcard" name="use_trugiftcard"
                                           title="<?php echo $this->__('Use Trunited Gift Card') ?>"
                                           <?php if ($is_applied_tgc){ ?>checked="checked"<?php } ?>
                                    />
                                    <span><?php echo $this->__('Apply Trunited Gift Card balance when available') ?></span>
                                </label>
                                <img
                                        src="<?php echo $this->getSkinUrl('images/onestepcheckout/flatnew/trugiftcard.png'); ?>"
                                        title="<?php echo $this->__('Trunited Gift Card balance'); ?>"/>
                            </div>
                        </li>

                    </ul>
                    <div class="clearfix"></div>
                </div>

                <div class="orange_btn_blk pad12 last">
                    <ul>
                        <li class="col-xs-4">
                            <button type="button" class="btn_blk transition"
                                    onclick="window.location.href='<?php echo $this->getBackAction();?>'"><?php echo $this->__('Back');?></button>
                        </li>
                        <li class="col-xs-4">
                            <button type="submit" class="btn_blk transition">
                                <?php echo $this->__('Save');?>
                            </button>
                        </li>
                    </ul>
                    <div class="clearfix"></div>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="clearfix"></div>

<script type="text/javascript">
    var occasion_payment_information = new VarienForm('occasion-payment-information', true);

    $j = jQuery.noConflict();

    $j('.main-container').addClass('main_block main_bg2');
    $j('.page-title').focus();

    $$('.cvv-what-is-this').each(function (element) {
        Event.observe(element, 'click', toggleToolTip);
    });

    $j(document).ready(function(e) {
        $j(".sidebar").removeClass('active');
        $j(".sidebar.trubox_brands").addClass('active').show();
        $j(".sidebar.trubox_brands .sub_blk").slideDown();
    });
</script>

